<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Christmas Game</title>
<style>
html, body{
    margin:0; padding:0; height:100%; font-family:Arial,sans-serif;
    background:radial-gradient(circle at top,#0b3c2d,#000);
    color:#fff; overflow:hidden;
}
body{ display:flex; flex-direction:column; align-items:center; }

/* HEADER */
h2{ margin:15px 0 5px; font-size:32px; color:#00ff66; text-shadow:0 0 10px #00ff66,0 0 25px #00ff66; }
p{ color:#ff4444; text-shadow:0 0 10px #ff4444; }

/* GAME AREA */
#game{
    position:relative; width:100vw; height:calc(100vh - 110px);
    background:rgba(255,255,255,0.02);
    box-shadow:0 0 20px #00ff66 inset,0 0 30px #ff0000 inset;
    overflow:hidden;
}

/* SNOWMAN */
.snowman{ position:absolute; width:60px; height:60px; cursor:pointer; user-select:none; }

/* GAME OVER SCREEN */
#over{
    display:none; position:fixed; inset:0; background:rgba(0,0,0,0.9);
    z-index:10; flex-direction:column; justify-content:center; align-items:center;
}

button{
    padding:12px 26px; border:none; border-radius:10px;
    background:linear-gradient(45deg,#ff0000,#00ff66);
    font-size:16px; font-weight:bold; cursor:pointer; margin:8px;
    box-shadow:0 0 10px #ff0000,0 0 20px #00ff66;
}
button:hover{ transform:scale(1.05); }
</style>
</head>
<body>

<h2>üéÑ Snowball Shooter</h2>
<p>Player: <b id="player"></b> | Score: <span id="score">0</span></p>

<div id="game"></div>

<div id="over">
    <h2>Game Over üéÆ</h2>
    <p id="finalScore"></p>
    <button onclick="openScoreboard()">üèÜ View Scoreboard</button>
    <button onclick="startGame()">üîÑ Play Again</button>
    <button onclick="location.href='choice.html'">‚¨Ö Back</button>
</div>

<script type="module">
// üî• FIREBASE IMPORT
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import { getFirestore, collection, addDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

// üî• FIREBASE CONFIG
const firebaseConfig = {
  apiKey: "AIzaSyDiwnacK-zGX0htpVQpnbGfJuIu07qfkx4",
  authDomain: "christmas-scoreboard.firebaseapp.com",
  projectId: "christmas-scoreboard",
  storageBucket: "christmas-scoreboard.firebasestorage.app",
  messagingSenderId: "318116745288",
  appId: "1:318116745288:web:4f2d74c7791664003ec87d"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

/* SOUND EFFECTS */
const hitSound = new Audio("hit.mp3");
const overSound = new Audio("gameover.mp3");

/* GAME VARIABLES */
const game = document.getElementById("game");
const scoreText = document.getElementById("score");
const finalScore = document.getElementById("finalScore");

const playerName = localStorage.getItem("playerName") || "Player";
document.getElementById("player").textContent = playerName;

let score = 0;
let ended = false;
let spawnDelay = 900;
let lifeTime = 2000;
let loopTimeout;

/* START GAME */
function startGame(){
    clearTimeout(loopTimeout);
    game.innerHTML = '';
    score = 0;
    ended = false;
    spawnDelay = 900;
    lifeTime = 2000;
    scoreText.textContent = "0";
    document.getElementById("over").style.display = "none";

    spawnNext();
}

/* SPAWN SNOWMAN SEQUENTIALLY */
function spawnNext(){
    if(ended) return;

    const img = new Image();
    img.src = "snowman.png";
    img.className = "snowman";

    img.onload = () => {
        if(ended) return;

        img.style.left = Math.random()*(game.clientWidth-60)+'px';
        img.style.top = Math.random()*(game.clientHeight-60)+'px';

        img.onclick = () => {
            if(ended) return;
            hitSound.currentTime = 0;
            hitSound.play().catch(()=>{});
            score += 10;
            scoreText.textContent = score;
            img.remove();
        };

        game.appendChild(img);

        setTimeout(() => {
            if(game.contains(img) && !ended){
                endGame();
            }
        }, lifeTime);

        // Schedule next spawn after spawnDelay
        loopTimeout = setTimeout(spawnNext, spawnDelay);

        // Increase difficulty gradually
        if(spawnDelay > 400) spawnDelay -= 20;
        if(lifeTime > 600) lifeTime -= 80;
    };
}

/* END GAME */
async function endGame(){
    if(ended) return;
    ended = true;
    clearTimeout(loopTimeout);
    finalScore.textContent = "Your Score: " + score;
    document.getElementById("over").style.display = "flex";

    try {
        await addDoc(collection(db,"scores"),{
            name: playerName,
            score: score,
            time: serverTimestamp()
        });
    } catch(e){
        console.error("Error saving score:", e);
    }

}

/* VIEW SCOREBOARD */
function openScoreboard(){
    location.href = "scoreboard.html";
}

window.startGame = startGame;

startGame();
</script>

</body>
</html>

